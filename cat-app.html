<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Cat Toy</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      touch-action: none;
    }
    #main {
      position: absolute;
      transition: transform 0.1s ease-out;
      cursor: pointer;
      user-select: none;
      z-index: 10;
    }
    .target {
      position: absolute;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .target:hover { transform: scale(1.3); }
    .particle {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
    }
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 100;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 95%;
    }
    .btn {
      padding: 12px 16px;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      background: rgba(255,255,255,0.25);
      color: #fff;
      cursor: pointer;
      backdrop-filter: blur(5px);
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    .btn.active {
      background: rgba(255,255,255,0.5);
      box-shadow: 0 0 15px rgba(255,255,255,0.5);
    }
    #speed-control {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.2);
      padding: 8px 15px;
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }
    #speed-control label { color: #fff; font-family: sans-serif; }
    #speed { width: 100px; }
    #fs {
      position: fixed;
      top: 20px; left: 20px;
      font-size: 32px;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 10px;
      padding: 10px 15px;
      color: #fff;
      cursor: pointer;
      z-index: 100;
    }
    #score {
      position: fixed;
      top: 20px; right: 20px;
      color: #fff;
      font-family: sans-serif;
      font-size: 24px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      z-index: 100;
    }
  </style>
</head>
<body>
  <button id="fs" onclick="document.documentElement.requestFullscreen()">â›¶</button>
  <div id="score"></div>
  <div id="main"></div>
  <div id="controls"></div>

  <script>
    const themes = {
      underwater: {
        name: 'ğŸ± Fish',
        bg: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
        main: 'ğŸ±',
        mainSize: 80,
        targets: ['ğŸŸ', 'ğŸ ', 'ğŸ¡'],
        targetSize: 40,
        particles: 'bubbles',
        scoreLabel: 'ğŸŸ'
      },
      laser: {
        name: 'ğŸ”´ Laser',
        bg: '#000000',
        main: '',
        mainSize: 30,
        mainStyle: 'width:30px;height:30px;background:radial-gradient(circle,#ff0000 0%,#ff0000 40%,#aa0000 70%,transparent 100%);border-radius:50%;box-shadow:0 0 20px #ff0000,0 0 40px #ff0000,0 0 60px #aa0000;',
        targets: [],
        particles: 'none',
        scoreLabel: ''
      },
      pond: {
        name: 'ğŸ¦† Ducks',
        bg: 'linear-gradient(180deg, #87CEEB 0%, #4A90A4 50%, #2E5A6B 100%)',
        main: 'ğŸ¾',
        mainSize: 60,
        targets: ['ğŸ¦†', 'ğŸ¦†', 'ğŸ¦†'],
        targetSize: 50,
        particles: 'ripples',
        scoreLabel: 'ğŸ¦†'
      },
      space: {
        name: 'ğŸš€ Space',
        bg: 'linear-gradient(135deg, #0c0c0c 0%, #1a0a2e 50%, #0a0a1a 100%)',
        main: 'ğŸš€',
        mainSize: 70,
        targets: ['â­', 'ğŸŒŸ', 'ğŸ’«', 'ğŸª'],
        targetSize: 35,
        particles: 'stars',
        scoreLabel: 'â­'
      },
      garden: {
        name: 'ğŸ¦‹ Garden',
        bg: 'linear-gradient(180deg, #90EE90 0%, #228B22 50%, #006400 100%)',
        main: 'ğŸ±',
        mainSize: 80,
        targets: ['ğŸ¦‹', 'ğŸ›', 'ğŸ', 'ğŸ¦—'],
        targetSize: 40,
        particles: 'leaves',
        scoreLabel: 'ğŸ¦‹'
      },
      yarn: {
        name: 'ğŸ§¶ Yarn',
        bg: 'linear-gradient(135deg, #F5DEB3 0%, #DEB887 50%, #D2691E 100%)',
        main: 'ğŸ±',
        mainSize: 80,
        targets: ['ğŸ§¶', 'ğŸ§µ', 'ğŸ€'],
        targetSize: 45,
        particles: 'fluff',
        scoreLabel: 'ğŸ§¶'
      },
      invaders: {
        name: 'ğŸ‘¾ Invaders',
        bg: '#000000',
        main: 'ğŸš€',
        mainSize: 60,
        targets: ['ğŸ‘¾'],
        targetSize: 50,
        particles: 'stars',
        scoreLabel: 'ğŸ‘¾',
        shooter: true
      },
      gameboy: {
        name: 'ğŸ® GameBoy',
        bg: '#9bbc0f',
        main: '',
        mainSize: 64,
        mainSvg: `<svg viewBox="0 0 16 16" width="64" height="64" shape-rendering="crispEdges">
          <rect x="4" y="2" width="8" height="10" fill="#0f380f"/>
          <rect x="3" y="3" width="2" height="2" fill="#0f380f"/>
          <rect x="11" y="3" width="2" height="2" fill="#0f380f"/>
          <rect x="5" y="4" width="2" height="2" fill="#9bbc0f"/>
          <rect x="9" y="4" width="2" height="2" fill="#9bbc0f"/>
          <rect x="6" y="5" width="1" height="1" fill="#0f380f"/>
          <rect x="9" y="5" width="1" height="1" fill="#0f380f"/>
          <rect x="7" y="7" width="2" height="1" fill="#306230"/>
          <rect x="5" y="9" width="6" height="1" fill="#9bbc0f"/>
          <rect x="4" y="10" width="1" height="1" fill="#9bbc0f"/>
          <rect x="11" y="10" width="1" height="1" fill="#9bbc0f"/>
          <rect x="2" y="0" width="2" height="2" fill="#0f380f"/>
          <rect x="12" y="0" width="2" height="2" fill="#0f380f"/>
          <rect x="6" y="13" width="1" height="2" fill="#0f380f"/>
          <rect x="9" y="13" width="1" height="2" fill="#0f380f"/>
          <rect x="5" y="14" width="1" height="2" fill="#0f380f"/>
          <rect x="10" y="14" width="1" height="2" fill="#0f380f"/>
        </svg>`,
        targets: [],
        targetSize: 40,
        particles: 'none',
        scoreLabel: '',
        gbColor: '#0f380f'
      }
    };

    let currentTheme = 'underwater';
    let speedMultiplier = 1;
    let x, y, vx, vy;
    let targetX, targetY, chasing = false;
    let score = 0;
    let targets = [];
    let bullets = [];
    let animationId;

    const main = document.getElementById('main');
    const scoreEl = document.getElementById('score');
    const controlsEl = document.getElementById('controls');

    function init() {
      x = window.innerWidth / 2;
      y = window.innerHeight / 2;
      vx = (2 + Math.random() * 2) * speedMultiplier;
      vy = (1.5 + Math.random() * 2) * speedMultiplier;
      score = 0;
      targets.forEach(t => t.remove());
      targets = [];
      bullets.forEach(b => b.el.remove());
      bullets = [];
      document.querySelectorAll('.particle').forEach(p => p.remove());
      applyTheme();
    }

    function applyTheme() {
      const t = themes[currentTheme];
      document.body.style.background = t.bg;

      if (t.mainSvg) {
        main.innerHTML = t.mainSvg;
        main.style.cssText = `width: ${t.mainSize}px; height: ${t.mainSize}px; image-rendering: pixelated;`;
      } else if (t.mainStyle) {
        main.textContent = '';
        main.innerHTML = '';
        main.style.cssText = t.mainStyle;
      } else {
        main.innerHTML = '';
        main.textContent = t.main;
        main.style.cssText = `font-size: ${t.mainSize}px; filter: drop-shadow(0 0 20px rgba(255,200,100,0.5));`;
      }

      scoreEl.textContent = t.scoreLabel ? `${t.scoreLabel} ${score}` : '';

      // Spawn targets
      if (t.targets.length > 0) {
        for (let i = 0; i < 5; i++) {
          setTimeout(() => spawnTarget(), i * 300);
        }
      }

      // Update buttons
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === currentTheme);
      });
    }

    function spawnTarget() {
      const t = themes[currentTheme];
      if (t.targets.length === 0) return;

      const el = document.createElement('div');
      el.className = 'target';
      el.textContent = t.targets[Math.floor(Math.random() * t.targets.length)];
      el.style.fontSize = t.targetSize + 'px';
      el.style.left = Math.random() * (window.innerWidth - 60) + 'px';
      el.style.top = Math.random() * (window.innerHeight - 150) + 'px';
      el.onclick = () => catchTarget(el);
      document.body.appendChild(el);
      targets.push(el);
    }

    function catchTarget(el) {
      const rect = el.getBoundingClientRect();
      createCatchEffect(rect.left, rect.top);
      el.remove();
      targets = targets.filter(t => t !== el);
      score++;
      const t = themes[currentTheme];
      scoreEl.textContent = t.scoreLabel ? `${t.scoreLabel} ${score}` : '';
      setTimeout(spawnTarget, 1000 + Math.random() * 2000);
    }

    function createCatchEffect(x, y) {
      for (let i = 0; i < 5; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = x + 'px';
        p.style.top = y + 'px';
        p.style.width = '10px';
        p.style.height = '10px';
        p.style.background = ['#ff0', '#f0f', '#0ff', '#0f0'][Math.floor(Math.random()*4)];
        p.style.transition = 'all 0.5s ease-out';
        document.body.appendChild(p);
        setTimeout(() => {
          p.style.transform = `translate(${(Math.random()-0.5)*100}px, ${(Math.random()-0.5)*100}px) scale(0)`;
          p.style.opacity = '0';
        }, 10);
        setTimeout(() => p.remove(), 500);
      }
    }

    function createParticle() {
      const t = themes[currentTheme];
      if (t.particles === 'none') return;

      const p = document.createElement('div');
      p.className = 'particle';

      if (t.particles === 'bubbles') {
        const size = 10 + Math.random() * 25;
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.background = 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(100,200,255,0.3))';
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.top = window.innerHeight + 'px';
        p.style.transition = `all ${3 + Math.random() * 3}s linear`;
        document.body.appendChild(p);
        setTimeout(() => { p.style.top = '-50px'; p.style.opacity = '0'; }, 10);
      } else if (t.particles === 'stars') {
        p.textContent = ['âœ¨', 'Â·', 'â€¢'][Math.floor(Math.random()*3)];
        p.style.fontSize = (10 + Math.random() * 15) + 'px';
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.top = Math.random() * window.innerHeight + 'px';
        p.style.color = '#fff';
        p.style.transition = 'opacity 1s';
        document.body.appendChild(p);
        setTimeout(() => { p.style.opacity = '0'; }, 500);
      } else if (t.particles === 'leaves') {
        p.textContent = ['ğŸƒ', 'ğŸŒ¿', 'â˜˜ï¸'][Math.floor(Math.random()*3)];
        p.style.fontSize = '20px';
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.top = '-30px';
        p.style.transition = `all ${4 + Math.random() * 3}s linear`;
        document.body.appendChild(p);
        setTimeout(() => {
          p.style.top = window.innerHeight + 50 + 'px';
          p.style.left = (parseFloat(p.style.left) + (Math.random()-0.5)*200) + 'px';
        }, 10);
      } else if (t.particles === 'ripples') {
        p.style.width = '20px';
        p.style.height = '20px';
        p.style.border = '2px solid rgba(255,255,255,0.5)';
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.top = Math.random() * window.innerHeight + 'px';
        p.style.transition = 'all 2s ease-out';
        document.body.appendChild(p);
        setTimeout(() => { p.style.transform = 'scale(4)'; p.style.opacity = '0'; }, 10);
      } else if (t.particles === 'fluff') {
        p.textContent = 'â€¢';
        p.style.fontSize = (5 + Math.random() * 10) + 'px';
        p.style.color = ['#fff', '#fdd', '#ddf'][Math.floor(Math.random()*3)];
        p.style.left = Math.random() * window.innerWidth + 'px';
        p.style.top = Math.random() * window.innerHeight + 'px';
        p.style.transition = `all ${2 + Math.random() * 2}s linear`;
        document.body.appendChild(p);
        setTimeout(() => {
          p.style.top = (parseFloat(p.style.top) + (Math.random()-0.5)*100) + 'px';
          p.style.opacity = '0';
        }, 10);
      }

      setTimeout(() => p.remove(), 6000);
    }

    function fireBullet(tx, ty) {
      const t = themes[currentTheme];
      if (!t.shooter) return;

      const bullet = document.createElement('div');
      bullet.className = 'particle';
      bullet.textContent = 'ğŸ’¥';
      bullet.style.fontSize = '20px';
      bullet.style.left = (x + t.mainSize/2) + 'px';
      bullet.style.top = (y + t.mainSize/2) + 'px';
      bullet.style.zIndex = '5';
      document.body.appendChild(bullet);

      const dx = tx - x;
      const dy = ty - y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const bvx = (dx / dist) * 12;
      const bvy = (dy / dist) * 12;

      bullets.push({ el: bullet, x: x + t.mainSize/2, y: y + t.mainSize/2, vx: bvx, vy: bvy });
    }

    function createExplosion(ex, ey) {
      for (let i = 0; i < 8; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.textContent = ['ğŸ’¥', 'âœ¨', 'âš¡'][Math.floor(Math.random()*3)];
        p.style.fontSize = '25px';
        p.style.left = ex + 'px';
        p.style.top = ey + 'px';
        p.style.transition = 'all 0.4s ease-out';
        p.style.zIndex = '50';
        document.body.appendChild(p);
        const angle = (i / 8) * Math.PI * 2;
        setTimeout(() => {
          p.style.left = (ex + Math.cos(angle) * 80) + 'px';
          p.style.top = (ey + Math.sin(angle) * 80) + 'px';
          p.style.opacity = '0';
        }, 10);
        setTimeout(() => p.remove(), 400);
      }
    }

    function setTarget(e) {
      const touch = e.touches ? e.touches[0] : e;
      targetX = touch.clientX;
      targetY = touch.clientY;

      // Fire bullet in shooter mode
      const t = themes[currentTheme];
      if (t.shooter) {
        fireBullet(targetX, targetY);
      }

      chasing = true;
      setTimeout(() => chasing = false, 3000);
    }
    document.addEventListener('click', setTarget);
    document.addEventListener('touchstart', setTarget);

    function animate() {
      const t = themes[currentTheme];
      const size = t.mainSize || 30;
      const w = window.innerWidth - size;
      const h = window.innerHeight - size - 100;

      if (chasing) {
        const dx = targetX - x;
        const dy = targetY - y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > 5) {
          vx = (dx / dist) * 5 * speedMultiplier;
          vy = (dy / dist) * 5 * speedMultiplier;
        } else {
          chasing = false;
        }
      }

      x += vx;
      y += vy;

      if (x <= 0 || x >= w) {
        vx *= -1;
        vx += (Math.random() - 0.5) * 0.5 * speedMultiplier;
      }
      if (y <= 0 || y >= h) {
        vy *= -1;
        vy += (Math.random() - 0.5) * 0.5 * speedMultiplier;
      }

      x = Math.max(0, Math.min(w, x));
      y = Math.max(0, Math.min(h, y));

      if (Math.random() < 0.02) {
        vx += (Math.random() - 0.5) * 0.5 * speedMultiplier;
        vy += (Math.random() - 0.5) * 0.5 * speedMultiplier;
      }

      const speed = Math.sqrt(vx*vx + vy*vy);
      const maxSpeed = 6 * speedMultiplier;
      const minSpeed = 1 * speedMultiplier;
      if (speed > maxSpeed) { vx = (vx/speed) * maxSpeed; vy = (vy/speed) * maxSpeed; }
      if (speed < minSpeed) { vx *= 1.1; vy *= 1.1; }

      // Rotate based on direction (skip for laser dot and SVG)
      if (!t.mainStyle && !t.mainSvg) {
        const angle = Math.atan2(vy, vx) * 180 / Math.PI;
        const flip = vx < 0 ? 'scaleX(-1)' : '';
        main.style.transform = `${flip} rotate(${vx < 0 ? -angle-180 : angle}deg)`;
      } else if (t.mainSvg) {
        // Just flip horizontally for SVG
        main.style.transform = vx < 0 ? 'scaleX(-1)' : '';
      }
      main.style.left = x + 'px';
      main.style.top = y + 'px';

      // Check collisions (main with targets)
      targets.forEach(target => {
        const tr = target.getBoundingClientRect();
        const tx = tr.left + tr.width/2;
        const ty = tr.top + tr.height/2;
        const dist = Math.sqrt((x+size/2-tx)**2 + (y+size/2-ty)**2);
        if (dist < 50) catchTarget(target);
      });

      // Update bullets
      bullets = bullets.filter(b => {
        b.x += b.vx;
        b.y += b.vy;
        b.el.style.left = b.x + 'px';
        b.el.style.top = b.y + 'px';

        // Check if bullet is off screen
        if (b.x < -50 || b.x > window.innerWidth + 50 || b.y < -50 || b.y > window.innerHeight + 50) {
          b.el.remove();
          return false;
        }

        // Check bullet collision with invaders
        for (let i = targets.length - 1; i >= 0; i--) {
          const target = targets[i];
          const tr = target.getBoundingClientRect();
          const tx = tr.left + tr.width/2;
          const ty = tr.top + tr.height/2;
          const dist = Math.sqrt((b.x - tx)**2 + (b.y - ty)**2);
          if (dist < 40) {
            createExplosion(tx, ty);
            target.remove();
            targets.splice(i, 1);
            score++;
            scoreEl.textContent = t.scoreLabel ? `${t.scoreLabel} ${score}` : '';
            setTimeout(spawnTarget, 1500 + Math.random() * 1500);
            b.el.remove();
            return false;
          }
        }
        return true;
      });

      animationId = requestAnimationFrame(animate);
    }

    // Create controls
    Object.keys(themes).forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'btn theme-btn';
      btn.dataset.theme = key;
      btn.textContent = themes[key].name;
      btn.onclick = (e) => {
        e.stopPropagation();
        currentTheme = key;
        init();
      };
      controlsEl.appendChild(btn);
    });

    const speedDiv = document.createElement('div');
    speedDiv.id = 'speed-control';
    speedDiv.innerHTML = '<label>ğŸ¢</label><input type="range" id="speed" min="0.3" max="3" step="0.1" value="1"><label>ğŸ‡</label>';
    controlsEl.appendChild(speedDiv);
    document.getElementById('speed').oninput = (e) => {
      e.stopPropagation();
      speedMultiplier = parseFloat(e.target.value);
    };
    document.getElementById('speed').onclick = (e) => e.stopPropagation();

    // Particles
    setInterval(createParticle, 400);

    // Start
    init();
    animate();
  </script>
</body>
</html>
